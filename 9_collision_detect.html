<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>刚体的碰撞检测 - Broad Phase - GAMES103</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="The note of GAMES103">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/pagetoc.css">
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">BackGround</li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> 数学基础</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="2_math_vector.html"><strong aria-hidden="true">2.1.</strong> Vector</a></li><li class="chapter-item expanded "><a href="2_math_matrix.html"><strong aria-hidden="true">2.2.</strong> Matrix</a></li><li class="chapter-item expanded "><a href="2_math_calculus.html"><strong aria-hidden="true">2.3.</strong> Tensor Calculus</a></li></ol></li><li class="chapter-item expanded "><a href="Graphics.html"><strong aria-hidden="true">3.</strong> 图形学基础</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> 仿真的基本单位</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Unit/Particle.html"><strong aria-hidden="true">4.1.</strong> 粒子</a></li><li class="chapter-item expanded "><a href="Unit/Grid.html"><strong aria-hidden="true">4.2.</strong> 格子</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.</strong> 粒子与格子的混合</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> 刚体 - 粒子以相对位置不变的关系聚合</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="Rigid/Attribution.html"><strong aria-hidden="true">5.1.</strong> 刚体的属性</a></li><li class="chapter-item expanded "><a href="Rigid/Force.html"><strong aria-hidden="true">5.2.</strong> 刚体动力学</a></li><li class="chapter-item expanded "><a href="Rigid/supplementary.html"><strong aria-hidden="true">5.3.</strong> 补充</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> 粒子与刚体组成的系统</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="ParticleRigid/Attribution.html"><strong aria-hidden="true">6.1.</strong> 系统的属性</a></li></ol></li><li class="chapter-item expanded "><a href="4_rigidcontact.html"><strong aria-hidden="true">7.</strong> 刚体系统 - 多个刚体组成的系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="4_rigidcontact_Particle.html"><strong aria-hidden="true">7.1.</strong> 粒子的碰撞检测与响应</a></li><li class="chapter-item expanded "><a href="9_collision_detect.html" class="active"><strong aria-hidden="true">7.2.</strong> 刚体的碰撞检测 - Broad Phase</a></li><li class="chapter-item expanded "><a href="9_collision_detect_narrow.html"><strong aria-hidden="true">7.3.</strong> 刚体的碰撞检测 - Narrow Phase</a></li><li class="chapter-item expanded "><a href="4_rigidcontact_Rigid.html"><strong aria-hidden="true">7.4.</strong> Energy Based 刚体碰撞响应</a></li><li class="chapter-item expanded "><a href="9_collision_response.html"><strong aria-hidden="true">7.5.</strong> Constrain Based 刚体碰撞响应</a></li><li class="chapter-item expanded "><a href="4_rigidcontact_supplementary.html"><strong aria-hidden="true">7.6.</strong> 补充</a></li><li class="chapter-item expanded "><a href="9_collision_summary.html"><strong aria-hidden="true">7.7.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">弹性体</li><li class="chapter-item expanded "><a href="5_cloth.html"><strong aria-hidden="true">8.</strong> 布料</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="5_cloth_spring.html"><strong aria-hidden="true">8.1.</strong> Mass Spring System</a></li><li class="chapter-item expanded "><a href="5_cloth_bending_blcoking.html"><strong aria-hidden="true">8.2.</strong> Bending and Locking Issues</a></li></ol></li><li class="chapter-item expanded "><a href="5_cloth_shape_matching.html"><strong aria-hidden="true">9.</strong> Shape Matching</a></li><li class="chapter-item expanded "><a href="6_constraints.html"><strong aria-hidden="true">10.</strong> 约束方法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="6_constraints_Projection.html"><strong aria-hidden="true">10.1.</strong> 投影函数 Projection Function</a></li><li class="chapter-item expanded "><a href="6_constraints_PBD.html"><strong aria-hidden="true">10.2.</strong> PBD</a></li><li class="chapter-item expanded "><a href="6_constraints_strain.html"><strong aria-hidden="true">10.3.</strong> Strain Limiting</a></li><li class="chapter-item expanded "><a href="6_constraints_Projective_Dynamics.html"><strong aria-hidden="true">10.4.</strong> 投影动力学 (Projective Dynamics)</a></li><li class="chapter-item expanded "><a href="6_constraints_Contrained_Dynamics.html"><strong aria-hidden="true">10.5.</strong> Contrained Dynamics</a></li><li class="chapter-item expanded "><a href="6_constraints_summary.html"><strong aria-hidden="true">10.6.</strong> 总结</a></li></ol></li><li class="chapter-item expanded "><a href="7_FEM.html"><strong aria-hidden="true">11.</strong> 07-FEM</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="7_FEM_FEM.html"><strong aria-hidden="true">11.1.</strong> Linear Finite Element Method</a></li><li class="chapter-item expanded "><a href="7_FEM_FVM.html"><strong aria-hidden="true">11.2.</strong> Finite Volume Method</a></li><li class="chapter-item expanded "><a href="7_FEM_Hyperelastic.html"><strong aria-hidden="true">11.3.</strong> Hyperelastic Models</a></li><li class="chapter-item expanded "><a href="7_FEM_summary.html"><strong aria-hidden="true">11.4.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="8_FEM2.html"><strong aria-hidden="true">12.</strong> 08-FEM2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="8_FEM2_Nonlinear_optimization.html"><strong aria-hidden="true">12.1.</strong> Nonlinear optimization</a></li></ol></li><li class="chapter-item expanded "><a href="9_collision_untangling.html"><strong aria-hidden="true">13.</strong> Untangling Cloth</a></li><li class="chapter-item expanded affix "><li class="part-title">Grid - 整齐排布的格子</li><li class="chapter-item expanded "><a href="Grid.html"><strong aria-hidden="true">14.</strong> Grid</a></li><li class="chapter-item expanded affix "><li class="part-title">水</li><li class="chapter-item expanded "><a href="10_wave.html"><strong aria-hidden="true">15.</strong> 10-wave</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> 高度场模型</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="10_wave_height_feild.html"><strong aria-hidden="true">16.1.</strong> 高度场模型</a></li><li class="chapter-item expanded "><a href="10_wave_volume.html"><strong aria-hidden="true">16.2.</strong> Volume Preservation</a></li><li class="chapter-item expanded "><a href="10_wave_boundary.html"><strong aria-hidden="true">16.3.</strong> Boundary Conditions</a></li><li class="chapter-item expanded "><a href="10_wave_coupling.html"><strong aria-hidden="true">16.4.</strong> Two-Way Coupling</a></li><li class="chapter-item expanded "><a href="10_wave_summary.html"><strong aria-hidden="true">16.5.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="11_EulerianFluids.html"><strong aria-hidden="true">17.</strong> 欧拉模型</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="11_EulerianFluids_Grid.html"><strong aria-hidden="true">17.1.</strong> A Grid Representation and Finite Differencing</a></li><li class="chapter-item expanded "><a href="11_EulerianFluids_Staggered.html"><strong aria-hidden="true">17.2.</strong> Staggered Grid</a></li><li class="chapter-item expanded "><a href="11_EulerianFluids_Incompressible.html"><strong aria-hidden="true">17.3.</strong> Incompressible, Viscous  Navier-Stokes Equations</a></li><li class="chapter-item expanded "><a href="11_EulerianFluids_Air_Smoke.html"><strong aria-hidden="true">17.4.</strong> Air and Smoke</a></li><li class="chapter-item expanded "><a href="11_EulerianFluids_Summary.html"><strong aria-hidden="true">17.5.</strong> Summary</a></li></ol></li><li class="chapter-item expanded "><a href="12_SPH.html"><strong aria-hidden="true">18.</strong> SPH模型</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="12_SPH_SPH.html"><strong aria-hidden="true">18.1.</strong> A SPH Model</a></li><li class="chapter-item expanded "><a href="12_SPH_Fluids.html"><strong aria-hidden="true">18.2.</strong> SPH-Based Fluids</a></li><li class="chapter-item expanded "><a href="12_SPH_Display.html"><strong aria-hidden="true">18.3.</strong> Fluid Display</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GAMES103</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/CaterpillarStudyGroup/GAMES103_mdbook" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main><div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <p>P4</p>
<h1 id="collision-detection-pipeline"><a class="header" href="#collision-detection-pipeline">Collision Detection Pipeline</a></h1>
<p><img src="./assets/09-1.png" alt="" /></p>
<p>P5</p>
<h2 id="方法一spatial-partitioning"><a class="header" href="#方法一spatial-partitioning">方法一：Spatial Partitioning</a></h2>
<p>Spatial partitioning divides the space by a grid and stores objects into grid cells.</p>
<p>P6</p>
<h3 id="静止场景"><a class="header" href="#静止场景">静止场景</a></h3>
<p>To find pair candidates for collision test, we just have to check the grid cells.</p>
<p><img src="./assets/09-2.png" alt="" /></p>
<p>P7</p>
<h3 id="运动场景"><a class="header" href="#运动场景">运动场景</a></h3>
<p>If we need to consider moving objects, we just expand the object region.</p>
<p><img src="./assets/09-3.png" alt="" /></p>
<p>P8</p>
<h3 id="数据存储"><a class="header" href="#数据存储">数据存储</a></h3>
<p>Instead of allocating <strong>memories</strong> to cells, we can build an object-cell list and then sort them. This avoids memories wasted in empty cells.</p>
<blockquote>
<p>✅要解决的问题：3D空间需要划分出大量的小格。有的格子可能包含很多object. 大多数格子可能没有object.<br />
✅方法：3D数组转为list表示法。<br />
✅缺点：内存访问不连续。</p>
</blockquote>
<p><img src="./assets/09-5.png" alt="" /></p>
<p>P9</p>
<h4 id="morton-code"><a class="header" href="#morton-code">Morton Code</a></h4>
<blockquote>
<p>✅ Morton Code：一种对格子编号的顺序。</p>
</blockquote>
<p>One question is how to define the cell ID. Using the grid order is not optimal, since it cannot be easily extended and it is lack of locality. Morton code uses a Z-pattern instead.</p>
<p><img src="./assets/09-6.png" alt="" /></p>
<blockquote>
<p>✅ 希望内存访问尽量连续。也就是下一次访问的内存地址在上次的附近<br />
✅ Grid Order：横向访问连续、纵向访问不连续、三维情况会更严重。</p>
</blockquote>
<p><img src="./assets/09-7.png" alt="" /></p>
<p>P10</p>
<h2 id="after-class-reading"><a class="header" href="#after-class-reading">After-Class Reading</a></h2>
<p>GPU Gems 3</p>
<p>Chapter 32. Broad-Phase Collision Detectionwith CUDA</p>
<p>P14</p>
<h2 id="方法二bounding-volume-hierarchy"><a class="header" href="#方法二bounding-volume-hierarchy">方法二：Bounding Volume Hierarchy</a></h2>
<p>Bounding volume hierarchy is built on geometric/topological proximity of objects.</p>
<blockquote>
<p>✅空间划分→物体划分</p>
</blockquote>
<p>P16</p>
<h2 id="构造bounding-box"><a class="header" href="#构造bounding-box">构造Bounding Box</a></h2>
<p><u>Axis-aligned bounding box (AABB)</u> is the most popular bounding volume. Besides that, there are also <u>spheres</u> and <u>oriented bounding box (OBB)</u>.</p>
<p>Two AABBs intersect if and only if they intersect in every axis.</p>
<h2 id="构造bvh"><a class="header" href="#构造bvh">构造BVH</a></h2>
<p><img src="./assets/09-8.png" alt="" /></p>
<p>P15</p>
<h2 id="外部物体与身体相交检测"><a class="header" href="#外部物体与身体相交检测">外部物体与身体相交检测</a></h2>
<p>To find elements potentially in collision with an object, we just traverse the tree.</p>
<p><img src="./assets/09-9.png" alt="" /></p>
<p>P17</p>
<h2 id="自相交检测"><a class="header" href="#自相交检测">自相交检测</a></h2>
<p>To process <strong>self collisions</strong> by BVH, we define two procedures.</p>
<p><img src="./assets/09-10-1.png" alt="" /></p>
<p><img src="./assets/09-10.png" alt="" /></p>
<p>P18</p>
<p>The performance depends on the effectiveness of 剪枝。</p>
<table><thead><tr><th>ID</th><th>Year</th><th>Name</th><th>Note</th><th>Tags</th><th>Link</th></tr></thead><tbody>
<tr><td></td><td>2012</td><td>Energy-based Self-Collision Culling for Arbitrary Mesh Deformations</td><td>✅ 对每个区域计算能量，根据形变能量的大小来判断有没有可能相交，此方法不适用于衣服，因为在衣服模拟中大形变很常见、不代表有相交。</td><td></td><td></td></tr>
</tbody></table>
<p>P19</p>
<h1 id="comparison-between-sh-and-bvh"><a class="header" href="#comparison-between-sh-and-bvh">Comparison between SH and BVH</a></h1>
<ul>
<li>
<p>Spatial Hashing</p>
<ul>
<li>Easy to implement</li>
<li>GPU friendly</li>
<li>Needs to <u>recompute</u> after updating objects</li>
</ul>
</li>
<li>
<p>Bounding Volume Hierarchy</p>
<ul>
<li>More involved</li>
<li>Not GPU friendly</li>
<li>To update BVH, just update bounding volumes</li>
</ul>
</li>
</ul>
<blockquote>
<p>✅ CUDA 代码. NVIDIA 代码通常使用SH。GPU 喜欢简单粗爆的数据结构，BVH相对于GPU过于复杂。</p>
</blockquote>
<hr />
<blockquote>
<p>本文出自CaterpillarStudyGroup，转载请注明出处。</p>
<p>https://caterpillarstudygroup.github.io/GAMES103_mdbook/</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="4_rigidcontact_Particle.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="9_collision_detect_narrow.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="4_rigidcontact_Particle.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="9_collision_detect_narrow.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="theme/pagetoc.js"></script>
    </body>
</html>
